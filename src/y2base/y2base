#! /usr/bin/ruby

# TODO: option parsing
# TODO: help text
# TODO: user friendly output if client do not exist
# TODO: umask
# TODO: pathsearch initialization

# set env as first part, otherwise dummy UI will be created.
# for insts-sys it will be overwritten later
ENV["YAST_IS_RUNNING"] = "yes"

require "yast"
require "yast/y2base"

Yast::Y2Base.setup_signals

args = Yast::Y2Base.parse_arguments(ARGV.dup)

if (args[:client_name] == "installation" &&
    args[:client_options][:params].include?("initial"))
  ENV["YAST_IS_RUNNING"] = "instsys"
end

if !Yast::WFM.ClientExists(args[:client_name])
  $stderr.puts "No such client module #{args[:client_name]}"
  exit 1
end


Yast.ui_create(args[:server_name], args[:server_options])
Yast::WFM.CallFunction(args[:client_name], args[:client_options][:params])

0
